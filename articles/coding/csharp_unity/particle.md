# Система частиц

## Содержание

- [Создание и настройка частиц](#Создание-и-настройка-частиц)
- [Emission](#Emission)
- [Shape](#Shape)
- [Renderer](#Renderer)
- [Velocity over Lifetime](#Velocity-over-Lifetime)
- [Limit Velocity over Lifetime](#Limit-Velocity-over-Lifetime)
- [Другие вкладки настроек](#Другие-вкладки-настроек)
- [External Forces](#External-Forces)
- [Noise](#Noise)
- [Collision and Triggers](#Collision-and-Triggers)
- [Sub Emitters](#Sub-Emitters)
- [Texture Sheet Animation](#Texture-Sheet-Animation)
- [Lights](#Lights)
- [Форматы заполняемых значений](#Форматы-заполняемых-значений)
- [Скриптинг](#Скриптинг)

Частицы необходимы для создания различных спецэффектов в игре, например, взрывы, дым, огонь, брызги и так далее. Каждая система частиц состоит из объекта или объектов, которые выходят из **эмиттера** - источника частиц.

## Создание и настройка частиц

Нажав ПКМ в окне иерархии и выбрав **Effects/PartickeSystem**, можно добавить новую систему частиц. Так же появится рамка с основными параметрами, некоторые из которых можно изменять.

|Настройка|Описание
|---|---
|**Duration**|Длительность. **Looping** - зацикленность.
|**Prewarn**|Частицы стартуют с полной интенсивностью.
|**Start Delay**|Задержка перед запуском системы частиц.
|**Start Lifetime**|Время жизни частиц.
|**Start Speed**|Начальная скорость частиц.
|**Start Size**|Начальный размер частиц
|**3D Start Size**|Настройка начального размера частиц по осям.
|**Start Rotation**|Уровень стартового вращения частиц вокруг себя
|**3D Start Rotation**|То же, что и предыдущее, но можно настроить по осям.
|**Start Color**|Стартовый цвет частиц
|**Gravity Modifier**|Настройка гравитации
|**Simulation Space**|Система координат симуляции. **Local** - частицы никак не взаимодействуют с глобальными координатами. **World** - частицы взаимодействуют с глобальными координатами, например, при перемещении системы частиц возникает эффект как от дыма, если источник этого дыма перемещается в пространстве.
|**Scaling Mode**|Настройка отвечающая за форму эмиттера. **Hierarchy** - позиция, поворот и форма зависят от родителя. **Shape** - примерно то же самое, но размер эмиттера не влияет на количество частиц.
|**Play on Avake**|Запуск системы частиц сразу при старте игры.
|**Max Particles**|Максимальное количество частиц у эмиттера.
|**Auto Random Seed**|Рандомизация появления частиц.
|**Stop Action**|Действие при остановке системы частиц. **Disable** - отключение объекта. **Destroy** - уничтожение объекта. **Callback** - вызов функции из скрипта.
|**Culling Mode**|Поведение частиц, если они находятся вне поля видимости игрока. **Pause and Catch-Up** - поставить на паузу и потом продолжить. **Pause** - поставить на паузу, а потом начать сначала. **Always Simulate** - всегда активны.
|**Ring Buffer Mode**|Поведение частиц в момент уничтожения. 

### Emission

|Настройка|Описание
|---|---
|**Rate over Time**|Количество выпускаемых частиц в секунду.
|**Rate over Distance**|Количество частиц, которое выпускается за 1 юнит в движении.
|**Bursts**|Позволяет более гибко настроить поведение частиц.

### Shape

**Shape** - Форма системы частиц.

### Renderer

|Настройка|Описание
|---|---
|**Render Mode**|Режим отрисовки частиц. **Billboard** - режим отрисовки, при которой спрайт всегда повернут к камере. **Mesh** - режим отрисовки мешем.

### Velocity over Lifetime

|Настройка|Описание
|---|---
|**Linear**|Отклонение частиц по осям.
|**Orbital**|Орбитальное отклонение частиц.
|**Offset**|Отступление от центра системы частиц.
|**Radial**|Скорость удаления частиц от центра масс.
|**Speed Modifier**|Множитель скорости.

### Limit Velocity over Lifetime

Позволяет ограничить скорость.

|Настройка|Описание
|---|---
|**Drag**|Сопротивление воздуха
|**Multiply by Size**|Влияние размера на сопротивление воздуха
|**Multiply by Velocity**|Влияние скорости на сопротивление воздуха

### Другие вкладки настроек

|Вкладка|Описание
|---|---
|**Force over Lifetime**|Контроль сил, которые действуют на систему частиц.
|**Color over Lifetime**|Контроль цвета частиц.
|**Color by Speed**|Цвет в зависимости от скорости частиц.
|**Size over Lifetime**|Контроль размера частиц.
|**Size by Speed**|Размер в зависимости от скорости частиц.
|**Rotation over Lifetime**|Контроль вращения частиц.
|**Rotation by Speed**|Вращение в зависимости от скорости частиц.

## External Forces

Здесь включается взаимодействие системы частиц с внешними физическими силами. Добавить внешнюю силу можно, если щелкнуть ПКМ в окне иерархии и выбрать **Effects/Particle System Force Field**.

## Noise

Позволяет внести случайность в движение частиц.

|Вкладка|Описание
|---|---
|**Strength**|Сила шума.
|**Frequency**|Резкость шума. Чем выше значения, тем резче движения частиц.
|**Scroll Speed**|Чем выше, тем беспорядочнее двигаются частицы.
|**Damping**|Сила пропорциональна частоте.
|**Octaves**|Детализация шума.
|**Quality**|Качество шума.
|**Position Amount**|Множитель положения.
|**Rotation Amount**|Множитель вращения.
|**Size Amount**|Множитель размера.

## Collision and Triggers

Отвечает за взаимодействие с другими объектами. Может сильно влиять на производительность.

## Sub Emitters

Позволяет сделать новые системы частиц из существующих, если соответствует определенному условию.

В первом параметре можно выбрать действие, при котором будет активироваться подсистема частиц. **Birth** - активно всегда и выходит из основного эмиттера. **Death** - срабатывает в момент смерти частицы на месте частицы. **Collision** и **Trigger** работают при физических столкновениях и триггерах, но нужно активировать для этого соответствующие вкладки. **Manual** - срабатывает по скрипту.

Вторая опция - выбор системы частиц. Можно нажать на плюс, и система сгенерируется автоматически. Настройка **Inherit** отвечает за то, что будет наследоваться подчастицами от основной системы. **Emit Probability** - вероятность выпускания подчастиц.

## Texture Sheet Animation

Позволяет анимировать текстуры частиц.

|Вкладка|Описание
|---|---
|**Mode**|Режим анимации.
|**Tiles**|Тайлы текстуры

## Lights

Позволяет добавить источники света на частицы.

### Порядок действий

1. Создать источник света и сохранить его префаб.
2. В системе частиц активировать вкладку **Lights**, поместить ранее созданный префаб в соответствующий слот.
3. Выставить **Ratio=1**.

## Форматы заполняемых значений

По умолчанию в значениях выступают целые числа или дробные, но напротив полей ввода есть стрелочка, нажав по которой, можно выбрать тип. 

## Скриптинг

```csharp
# Запуск системы частиц при нажатии пробела. 
# В условии методы вызывать по отдельности или совместно, в зависимости от ситуации.

public ParticleSystem ps;
void Update()
{
    if (Input.GetKeyDown(KeyCode.Space))
    {
    	ps.Play(); # Запустить
    	ps.Stop(); # Остановить
    	ps.Pause(); # Пауза
    }
}
```
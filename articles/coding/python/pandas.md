# Pandas

Здесь будет материал по анализу данных с помощью модуля Pandas. Для корректной работы необходим модуль Openpyxl.

Series - по сути проиндексованный список. DataFrame - табличный тип данных.

## Series

```python
# Создание Series

import pandas as pd
s=pd.Series([1,2,'name','age'])
print(s)
```

```
Вывод
0       1
1       2
2    name
3     age
dtype: object
```

Слева идут индексы, справа - значения. dtype - тип объекта Series.

Прописать свои индексы можно так...

```python
s=pd.Series([1,2,'name','age'],index=['a','a','c','d'])
```

Значения можно указать в виде словаря.

```python
s=pd.Series({'a':1,'b':2,'c':'name','d':'age'})
```

#### Получение данных Series

Обращение к значению как в словаре.

```python
print(s['d'])
print(s['a','d']) # 2 значения
```

Обращение к значению как в списке.

```python
print(s[1])
print(s[1:]) # В виде среза
```

Изменение значений

```python
s['a']='country'
s[1]='status'
```

### Фильтры

Чаще всего фильтры указываются в квадратных скобках.

Изменим Series.

```python
s=pd.Series({'a':5,'b':20,'c':10,'d':0})
```

Фильтры реализуются так...

```
print(database[условие]
```

```python
# Примеры фильтров

print(s[s>10]) # Выведет значения больше 10
print(s[s.isnull()]) # Выведет значения с NaN.
print(s[(s>10)|(s<15)]) # Оператор "и"
print(s[(s>10)&(s<15)]) # Оператор "или"
```

### Глубокое копирование

Позволяет скопировать Series или Dataframe, без него дает ссылку на объект.

```python
s2=s.copy()
```

### Агрегация

Агрегация - получение из множества значений одно значение, используя различные манипуляции с ними.

Получение нескольких значений.

```python
s.agg(['mean','max'])
```

|Свойство|Описание|Атрибуты
|---|---|---
|s.agg('min')|Минимальное значение|---
|s.agg('max')|Максимальное значение|---
|s.agg('sum')|Сумма|---
|s.agg('mean')|Среднее значение|---
|---|---|---
|---|---|---

### Apply

Apply - метод для обработки значений при помощи своей функции.

```python
def func(x): #Определение функции
	return 'fff'
print(s.apply(func)) # Применение функции
```

### Методы Series

|Свойство|Описание|Атрибуты
|---|---|---
|s.index|выводит диапазон значений.|---
|s.values|Выводит список значений.|---

#### Фильтры

|Свойство|Описание|Атрибуты
|---|---|---
|s.isnull()|Проверяет является ли значение NaN.|---
|s.notnull()|Проверяет является ли значение не NaN.|---
|s.shape|Количество строк|---
|s.count()|Количество не NaN значений|---
|s.copy()|Глубокое копирование.|---



## DataFrame

DataFrame - табличный тип данных.

Создание DataFrame

```python
s=pd.DataFrame({'Столбец':['Значения'],'Столбец':['Значения']})
```

Пример

```python
s=pd.DataFrame({'Страна':['Беларусь','Франция','Япония'],'Столица':['Минск','Париж','Токио']})
```

```
Вывод...

     Страна Столица
0  Беларусь   Минск
1   Франция   Париж
2    Япония   Токио
```

### Получение данных

```python
s['Колонка'] # Все значения колонки.
s[['Колонка1','Колонка2']] # Получение значений из нескольких колонок.
s['Колонка'][Индекс] # Получение значения строки.
s.iloc[Индекс] # Получение данных о строке.
s.loc['Именованный индекс'] # Получение данных о строке.
s.columns # Список всех колонок.
```

### Получение данных из файла

```python
s=pd.read_csv('Файл')
```

#### Атрибуты

|Атрибут|Описание|Пример использования
|---|---|---
|names|Указывает какие колонки вывести|names=['Колонка1','Колонка2']
|sep|Сепаратор|sep=';'
|---|---|---
|---|---|---
|---|---|---
|---|---|---
|---|---|---
|---|---|---

#### Методы

|Атрибут|Описание|Пример использования
|---|---|---
|s.columns()|---|---
|s.head()|Данные в начале DataFrame. В скобках можно указывать количество строк.60 - максимальное количество по умолчанию.|---
|s.tail()|Данные в конце DataFrame. В скобках можно указывать количество строк.60 - максимальное количество по умолчанию.|---
|s.shape|Возвращает кортеж из количества строк и столбцов|---
|s.info()|Информация о DataFrame|---
|s.isna()|Проверка на NaN|---
|s.notna()|Проверка на не NaN|---
|s.describe()|Статистическая информация|---
|s.unique()|Уникальные значения|s['Колонка'].unique()
|s.iloc[Индекс]|Возвращает строку с индексом|Можно выводить не все колонки, а некоторые. s.iloc[Индекс][['Колонка1','Колонка2']]. Можно указать несколько строк используя срез. s.iloc[Индекс:Индекс]
|s.loc[Индекс]|Аналогичен iloc, но с явным индексом.|---


### Добавление и удаление колонок

Добавление колонки

```python
s['Новая колонка']='Значение столбцов'
```

Добавление колонки, копировав другую колонку

```python
s['Новая колонка']=s['Существующая колонка']
```

Создание колонки, основанной на математических действиях.

```python
s['Новая колонка']=s[Числовое значение]+50
# Можно то же самое делать и с строчными данными, как обычно.
```

Удаление колонки

```python
s.drop('Название колонки',axis=1,inplace=True)
```

axis - ось. Первая ось - ось колонок. 0 - ось строк. Inplace - перезапись DataFrame на месте. Без него не будет работать.

Удаление строк с NaN

```python
s.dropna()
```

В скобках можно указать колонки, где именно искать NaN.

```python
s.dropna(subset=[Колонка])
```

Заполнение NaN другими значениями происходит так...

```python
s.filna(Значение)
```

### Переименование колонок

```python
s.rename(columns={'Старое имя':'Новое имя'},inplace=True)
```

### Работа с NaN

Посчитать количество NaN в каждой колонке.

```python
s.rename(columns={'Старое имя':'Новое имя'},inplace=True)
```

Вывести строки, где NaN в определенной колонке.

```python
s[s['Колонка'].isna()]
```

Удаление NaN

```python
s.dropna(inplace=True)
```

Атрибут how=any удалит строку, где есть хотя бы 1 NaN, how=all - удалит строки, где все колонки имеют значение NaN.

Удаление, если 2 колонки у строки имеют NaN.

```python
s.dropna(how=all,subset=['Колонка1','Колонка2'],inplace=True)
```

Заполнение NaN.

```python
s.fillna(value=1000,inplace=True) # Заполняет все NaN значениями
s.fillna(value={'Колонка':Значение},inplace=True) # Заполняет все NaN значениями в указанных колонках
```

### Excel файлы

```python
s=pd.read_excel('Файл') # Открытие файла
s=pd.to_excel('Файл') # Сохранение файла
```

В Excel есть листы и Pandas по умолчанию читает первый лист. Чтобы прочитать нужную вкладку, нужно воспользоваться этим способом...

```python
s=pd.read_excel('Файл',sheet_name=0) # Открытие файла
```

Для sheet_name можно указать индекс листа или его имя.

### Работа с строками

Можно искать строки по ключевым словам или же частям слов. Пример ниже ищет строки со словами, которые содержат в себе ключевое значение. Чувствительно к регистру, так что аккуратнее с этим.

```python
s['Колонка'].str.contains('Ключевое значение')
```

Для применения регулярных выражений используется атрибут regex=True.

Еще несколько строковых методов.

```python
s['Колонка'].str.upper() # Все в верхнем регистре
s['Колонка'].str.lower() # Все в нижнем регистре

```
























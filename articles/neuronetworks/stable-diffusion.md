# Stable Diffusion

## Установка

Для установки достаточно скачать с Github [репозиторий](https://github.com/serpotapov/stable-diffusion-portable), затем запустить webui-user.bat и дождаться окончания установки. Для дальнейших запусков использовать этот же батник.

Если возникнут ошибки связанные с CUDA или недостающими элементами PyTorch, нужно установить CUDA и перезагрузить ПК. Далее удалить из репозитория папку venv и снова запустить батник, дождаться окончания установки.



## Установка моделей

Модели бывают нескольких типов. Trained - натренированная модель на множестве изображений. Merge - модель, состоящая из нескольких моделей. Так же есть 3 основные базы моделей - SD 1.5 - модели натренированные на изображениях 512 пикселей; SD 2.0 - натренированная на изображениях 768 пикселей; SDXL - 1024 пикселей.

Так же есть модели с расширением CKPT и safereference. Не рекомендуется использовать CKPT модели так как в них может быть зашит вредоносный код. CKPT можно конвертировать в safereference.

Скачанные модели нужно поместить в папку models/Stable-diffusion.


### Проверка моделей

Этот метод можно использовать для того, чтобы проверить работоспособность модели. После скачивания модели перейдите в стандартную модель или ту, что гарантированно работает. Далее введите любой запрос, нажмите Generate, дождитесь окончания генерации. После этого закрепите сид, нажав на зеленый значек напротив сида. Если повторно нажать Generate, то сгенерируется то же изображение. Теперь переключитесь на новую модель и, не меняя запроса и параметров, нажмите Generate. Если изображение не изменилось, значит модель не работает или есть другие проблемы. Если сгенерировалась новая картинка, значит модель исправна. Напомню, что все это надо делать, закрепив сид после генерации в рабочей модели!



## Интерфейс и режимы

### txt2img - текст в картинку

Здесь можно сгенерировать картинку по текстовому запросу.

**Prompt** - то, что должно быть в изображении.
**Negative Prompt** - то, чего не должно быть в изображении.
**Sampling steps** - семплы детализации.
**Width, Height** - ширина и высота изображения.
**CFG Scale** - насколько изображение соответствует запросу.
**Seed** - сид. Напротив сида есть 2 кнопки. Зеленая кнопка закрепляет сид, а кубик при следующей генерации использует случайный сид. Другими словами, если была сгенерирована картинка и если нажать зеленую кнопку, то при повторном нажатии на генерацию с теми же параметрами и запросом, будет сгенерирована такая же картинка. С кубиком будет другая картинка.


### img2img

Генерирует картинку используя другую картинку и запрос. Есть несколько режимов работы - Sketch и Inpaint и совмещенный режим. В данных режимах можно использовать маски.

#### img2img
Для простой генерации поместите картинку в левое поле, введите запрос и нажмите на генерацию. Чтоб все было немного быстрее установите Batch count на 1. Так же здесь есть фейдер Denoising strength - он отвечает за то, насколько будет меняться картинка. Если его выкрутить в 0, то картинка не изменится совсем.

#### inpaint
Этот режим позволяет дорисовать что-то на картинке. Для использования переключитесь на него и кистью выделите то место, где нужно внести изменения, а после этого нажмите на генерацию, предварительно введя запрос.
Для увеличения кисти, зажмите Ctrl и колесо мыши, для перемещения нажмите F и двигайте мышью. Для масштабирования нажмите Alt и колесо мыши.
В Mask Mode 2 режима - обычный и инвертированный.



### Extras

В этом режиме можно увеличить размер изображения, обрезать и так далее.

Для увеличения разрешения перетащите нужную картинку в левое поле. Upscaller 1 и Upscaller 2 отвечают за метод увеличения. В данном случае можно поставить Upscaller 1=ESRGAN_4x, Upscaller 2=R-ESRGAN 4x+, Upscaler 2 visibility=0.5. Resize отвечает во сколько раз нужно увеличить изображение. Далее просто нажмите Сгенерировать.
## Стили

В SD можно создать свои стили для запросов. Проще говоря, стили - это дополнительные фразы в запросах, которые будут выполняться вместе с основным запросом. Для создания стиля нужно нажать на Edit Styles - выглядит как карандаш и находится под оранжевой кнопкой запуска, написать название, заппрос и негативный запрос, далее нажать на сохранение.


